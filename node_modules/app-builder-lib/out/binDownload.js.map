{"version":3,"file":"binDownload.js","sourceRoot":"","sources":["../src/binDownload.ts"],"names":[],"mappings":";;AAeA,kCAcC;AAKD,8CAgCC;AAKD,4CAMC;AAsGD,4BAMC;AAED,kDAGC;AAED,sCAsBC;AAED,wBAYC;AApOD,qCAAoC;AACpC,uCAAwI;AACxI,+CAAsE;AAEtE,wDAA4D;AAC5D,sEAAkE;AAClE,kCAAiC;AACjC,yBAAwB;AACxB,6BAA4B;AAC5B,4CAA2C;AAC3C,2BAA0B;AAE1B;;GAEG;AACH,SAAgB,WAAW,CAAC,KAAa,EAAE,MAAM,GAAG,CAAC;IACnD,IAAI,IAAI,GAAG,IAAI,CAAA;IACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtC,IAAI,GAAG,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAA,CAAC,gBAAgB;IACpE,CAAC;IACD,wBAAwB;IACxB,IAAI,MAAM,CAAC,CAAA;IACX,mBAAmB;IACnB,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAA;IAC7B,gCAAgC;IAChC,IAAI,GAAG,CAAC,MAAM,IAAI,MAAM,EAAE,CAAC;QACzB,OAAO,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,MAAM,CAAC,CAAA;IAC7B,CAAC;IACD,OAAO,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;AAClC,CAAC;AAED;;GAEG;AACH,SAAgB,iBAAiB,CAAC,sBAAsB,GAAG,KAAK;;IAC9D,MAAM,GAAG,GAAG,MAAA,OAAO,CAAC,GAAG,CAAC,sBAAsB,0CAAE,IAAI,EAAE,CAAA;IACtD,IAAI,GAAG,EAAE,CAAC;QACR,OAAO,GAAG,CAAA;IACZ,CAAC;IAED,MAAM,OAAO,GAAG,kBAAkB,CAAA;IAElC,MAAM,QAAQ,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAA;IAC9B,MAAM,OAAO,GAAG,EAAE,CAAC,OAAO,EAAE,CAAA;IAE5B,IAAI,QAAQ,KAAK,QAAQ,EAAE,CAAC;QAC1B,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAA;IACzD,CAAC;IAED,IAAI,QAAQ,KAAK,OAAO,EAAE,CAAC;QACzB,MAAM,YAAY,GAAG,MAAA,OAAO,CAAC,GAAG,CAAC,YAAY,0CAAE,IAAI,EAAE,CAAA;QACrD,MAAM,QAAQ,GAAG,MAAA,MAAA,OAAO,CAAC,GAAG,CAAC,QAAQ,0CAAE,IAAI,EAAE,0CAAE,WAAW,EAAE,CAAA;QAC5D,MAAM,YAAY,GAAG,sBAAsB,IAAI,CAAC,CAAA,MAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,WAAW,EAAE,0CAAE,QAAQ,CAAC,uBAAuB,CAAC,KAAI,QAAQ,KAAK,QAAQ,CAAC,CAAA;QACxI,IAAI,CAAC,YAAY,IAAI,YAAY,EAAE,CAAC;YAClC,OAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE,GAAG,OAAO,QAAQ,CAAC,CAAA;QACnD,CAAC;QACD,OAAO,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,OAAO,EAAE,OAAO,CAAC,CAAA;IAClD,CAAC;IAED,QAAQ;IACR,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,CAAA;IAC3C,IAAI,QAAQ,EAAE,CAAC;QACb,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;IACrC,CAAC;IAED,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAA;AAC9C,CAAC;AAED;;GAEG;AACI,KAAK,UAAU,gBAAgB,CAAC,OAAoH;IACzJ,MAAM,EAAE,WAAW,EAAE,eAAe,EAAE,SAAS,EAAE,aAAa,GAAG,6CAA6C,EAAE,GAAG,OAAO,CAAA;IAE1H,MAAM,IAAI,GAAG,MAAM,iBAAiB,CAAC,sBAAsB,aAAa,qBAAqB,EAAE,WAAW,EAAE,eAAe,EAAE,SAAS,CAAC,CAAA;IAEvI,OAAO,IAAI,CAAA;AACb,CAAC;AAED;;GAEG;AACH,KAAK,UAAU,iBAAiB,CAAC,OAAe,EAAE,WAAmB,EAAE,eAAuB,EAAE,SAAiC;;IAC/H,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,OAAO,IAAI,WAAW,IAAI,eAAe,EAAE,EAAE,CAAC,CAAC,CAAA;IAC7E,MAAM,UAAU,GAAG,GAAG,eAAe,CAAC,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC,IAAI,MAAM,EAAE,CAAA;IACjF,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,EAAE,WAAW,EAAE,UAAU,CAAC,CAAA;IAC1E,MAAM,wBAAwB,GAAG,GAAG,UAAU,WAAW,CAAA;IAEzD,yDAAyD;IACzD,MAAM,EAAE,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAA;IAE/C,mBAAmB;IACnB,IAAI,OAA0C,CAAA;IAC9C,IAAI,CAAC;QACH,OAAO,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE;YACxC,OAAO,EAAE;gBACP,OAAO,EAAE,CAAC;gBACV,UAAU,EAAE,IAAI;gBAChB,UAAU,EAAE,IAAI;aACjB;YACD,KAAK,EAAE,KAAK;SACb,CAAC,CAAA;QAEF,MAAM,OAAO,GAAG,8BAA8B,CAAA;QAC9C,MAAM,aAAa,GAAG,MAAA,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,0CAAE,IAAI,EAAE,CAAA;QAElD,IAAI,SAAS,GAA8B,+BAAyB,CAAC,SAAS,CAAA;QAC9E,IAAI,aAAa,IAAI,MAAM,CAAC,aAAa,CAAC,IAAI,+BAAyB,EAAE,CAAC;YACxE,SAAS,GAAG,MAAM,CAAC,aAAa,CAAC,CAAA;YACjC,kBAAG,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,qCAAqC,OAAO,EAAE,CAAC,CAAA;QAChF,CAAC;QAED,IAAI,MAAM,IAAA,qBAAM,EAAC,wBAAwB,CAAC,EAAE,CAAC;YAC3C,kBAAG,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,mDAAmD,CAAC,CAAA;YAC3G,OAAO,UAAU,CAAA;QACnB,CAAC;QAED,0FAA0F;QAC1F,MAAM,OAAO,GAA4B;YACvC,2EAA2E;YAC3E,iGAAiG;YACjG,OAAO,EAAE,OAAO;YAChB,YAAY,EAAE,eAAe,EAAE,8BAA8B;SAC9D,CAAA;QAED,MAAM,QAAQ,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,6BAAa,EAAE,CAAC,CAAC,CAAC,IAAI,CAAA;QAClE,MAAM,WAAW,GAAG,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,SAAS,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,sBAAO,GAAG,CAAC,CAAC,qBAAqB,eAAe,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC,CAAA;QAEzH,MAAM,eAAe,GAAyB;YAC5C,mBAAmB,EAAE,IAAI,CAAC,EAAE;gBAC1B,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;gBAC9E,OAAO,OAAO,CAAC,OAAO,EAAE,CAAA;YAC1B,CAAC;SACF,CAAA;QACD,MAAM,OAAO,GAAmC;YAC9C,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,iBAAiB,EAAE,EAAE,WAAW,CAAC;YACzD,SAAS;YACT,eAAe;YACf,SAAS;YACT,aAAa,EAAE;gBACb,2DAA2D;gBAC3D,MAAM,EAAE,OAAO;gBACf,SAAS,EAAE,WAAW;gBACtB,cAAc,EAAE,eAAe;aAChC;SACF,CAAA;QAED,kBAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,IAAI,EAAE,eAAe,EAAE,EAAE,aAAa,CAAC,CAAA;QACxE,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,MAAM,EAAE,CAAA;QACrB,MAAM,cAAc,GAAG,MAAM,GAAG,CAAC,gBAAgB,CAAC;YAChD,GAAG,OAAO;YACV,GAAG,OAAO;YACV,SAAS,EAAE,IAAI;SAChB,CAAC,CAAA;QAEF,MAAM,GAAG,CAAC,OAAO,CAAC;YAChB,IAAI,EAAE,cAAc;YACpB,GAAG,EAAE,UAAU;YACf,KAAK,EAAE,CAAC,EAAE,iDAAiD;SAC5D,CAAC,CAAA;QAEF,+GAA+G;QAC/G,MAAM,EAAE,CAAC,SAAS,CAAC,wBAAwB,EAAE,EAAE,CAAC,CAAA;QAEhD,kBAAG,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,YAAY,CAAC,CAAA;QACpE,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,MAAM,CAAC,GAAG,CAAC,CAAA;QACxB,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,SAAS,EAAE,CAAA;QAExB,OAAO,UAAU,CAAA;IACnB,CAAC;YAAS,CAAC;QACT,mBAAmB;QACnB,IAAI,OAAO,EAAE,CAAC;YACZ,MAAM,OAAO,EAAE,CAAA;QACjB,CAAC;IACH,CAAC;AACH,CAAC;AAED,MAAM,gBAAgB,GAAG,IAAI,GAAG,EAA2B,CAAA;AAE3D,SAAgB,QAAQ,CAAC,GAAW,EAAE,MAAc,EAAE,QAAwB;IAC5E,MAAM,IAAI,GAAG,CAAC,UAAU,EAAE,OAAO,EAAE,GAAG,EAAE,UAAU,EAAE,MAAM,CAAC,CAAA;IAC3D,IAAI,QAAQ,IAAI,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAA;IACjC,CAAC;IACD,OAAO,IAAA,gCAAiB,EAAC,IAAI,CAAiB,CAAA;AAChD,CAAC;AAED,SAAgB,mBAAmB,CAAC,IAAY,EAAE,OAAe,EAAE,cAAsB,EAAE,QAAgB;IACzG,MAAM,OAAO,GAAG,GAAG,IAAI,IAAI,OAAO,EAAE,CAAA;IACpC,OAAO,MAAM,CAAC,OAAO,EAAE,cAAc,EAAE,QAAQ,CAAC,CAAA;AAClD,CAAC;AAED,SAAgB,aAAa,CAAC,WAAmB,EAAE,eAAuB,EAAE,QAAgB,EAAE,aAAa,GAAG,6CAA6C;IACzJ,IAAI,GAAW,CAAA;IACf,IAAI,OAAO,CAAC,GAAG,CAAC,+CAA+C,EAAE,CAAC;QAChE,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,+CAA+C,GAAG,GAAG,GAAG,eAAe,CAAA;IAC3F,CAAC;SAAM,CAAC;QACN,MAAM,OAAO,GACX,OAAO,CAAC,GAAG,CAAC,2CAA2C;YACvD,OAAO,CAAC,GAAG,CAAC,2CAA2C;YACvD,OAAO,CAAC,GAAG,CAAC,mDAAmD;YAC/D,OAAO,CAAC,GAAG,CAAC,gCAAgC;YAC5C,sBAAsB,aAAa,qBAAqB,CAAA;QAC1D,MAAM,SAAS,GACb,OAAO,CAAC,GAAG,CAAC,+CAA+C;YAC3D,OAAO,CAAC,GAAG,CAAC,+CAA+C;YAC3D,OAAO,CAAC,GAAG,CAAC,uDAAuD;YACnE,OAAO,CAAC,GAAG,CAAC,oCAAoC;YAChD,WAAW,CAAA;QACb,GAAG,GAAG,GAAG,OAAO,GAAG,SAAS,IAAI,eAAe,EAAE,CAAA;IACnD,CAAC;IAED,MAAM,QAAQ,GAAG,GAAG,WAAW,IAAI,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,EAAE,CAAA;IAClG,OAAO,MAAM,CAAC,QAAQ,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;AACxC,CAAC;AAED,SAAgB,MAAM,CAAC,QAAgB,EAAE,GAAmB,EAAE,QAAwB;;IACpF,6DAA6D;IAC7D,MAAM,SAAS,GAAG,IAAA,2BAAgB,EAAC,GAAG,MAAA,OAAO,CAAC,GAAG,CAAC,sBAAsB,mCAAI,EAAE,GAAG,QAAQ,EAAE,CAAC,CAAA;IAC5F,IAAI,OAAO,GAAG,gBAAgB,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA,CAAC,6CAA6C;IAE3F,IAAI,OAAO,IAAI,IAAI,EAAE,CAAC;QACpB,OAAO,OAAO,CAAA;IAChB,CAAC;IAED,OAAO,GAAG,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;IAC3C,gBAAgB,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;IACxC,OAAO,OAAO,CAAA;AAChB,CAAC;AAED,SAAS,QAAQ,CAAC,IAAY,EAAE,GAAqB,EAAE,QAA0B;IAC/E,MAAM,IAAI,GAAG,CAAC,mBAAmB,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA;IAClD,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;QAChB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,CAAA;IACzB,CAAC;IACD,IAAI,QAAQ,IAAI,IAAI,EAAE,CAAC;QACrB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAA;IACjC,CAAC;IACD,OAAO,IAAA,gCAAiB,EAAC,IAAI,CAAC,CAAA;AAChC,CAAC","sourcesContent":["import * as get from \"@electron/get\"\nimport { ElectronDownloadCacheMode, ElectronDownloadRequest, ElectronDownloadRequestOptions, GotDownloaderOptions } from \"@electron/get\"\nimport { executeAppBuilder, exists, log, PADDING } from \"builder-util\"\nimport { Nullish } from \"builder-util-runtime\"\nimport { sanitizeFileName } from \"builder-util/out/filename\"\nimport { MultiProgress } from \"electron-publish/out/multiProgress\"\nimport * as fs from \"fs/promises\"\nimport * as os from \"os\"\nimport * as path from \"path\"\nimport * as lockfile from \"proper-lockfile\"\nimport * as tar from \"tar\"\n\n/**\n * Deterministic <length>-character URL-safe hash (a–z0–9)\n */\nexport function hashUrlSafe(input: string, length = 6): string {\n  let hash = 5381\n  for (let i = 0; i < input.length; i++) {\n    hash = ((hash << 5) + hash) ^ input.charCodeAt(i) // hash * 33 ^ c\n  }\n  // Force unsigned 32-bit\n  hash >>>= 0\n  // Base-36 (0–9a–z)\n  const out = hash.toString(36)\n  // Ensure exactly `length` chars\n  if (out.length >= length) {\n    return out.slice(0, length)\n  }\n  return out.padStart(length, \"0\")\n}\n\n/**\n * Get cache directory for electron-builder\n */\nexport function getCacheDirectory(isAvoidSystemOnWindows = false): string {\n  const env = process.env.ELECTRON_BUILDER_CACHE?.trim()\n  if (env) {\n    return env\n  }\n\n  const appName = \"electron-builder\"\n\n  const platform = os.platform()\n  const homeDir = os.homedir()\n\n  if (platform === \"darwin\") {\n    return path.join(homeDir, \"Library\", \"Caches\", appName)\n  }\n\n  if (platform === \"win32\") {\n    const localAppData = process.env.LOCALAPPDATA?.trim()\n    const username = process.env.USERNAME?.trim()?.toLowerCase()\n    const isSystemUser = isAvoidSystemOnWindows && (localAppData?.toLowerCase()?.includes(\"\\\\windows\\\\system32\\\\\") || username === \"system\")\n    if (!localAppData || isSystemUser) {\n      return path.join(os.tmpdir(), `${appName}-cache`)\n    }\n    return path.join(localAppData, appName, \"Cache\")\n  }\n\n  // linux\n  const xdgCache = process.env.XDG_CACHE_HOME\n  if (xdgCache) {\n    return path.join(xdgCache, appName)\n  }\n\n  return path.join(homeDir, \".cache\", appName)\n}\n\n/**\n * Downloads an artifact from GitHub releases (convenience wrapper)\n */\nexport async function downloadArtifact(options: { releaseName: string; filenameWithExt: string; checksums: Record<string, string>; githubOrgRepo?: string }): Promise<string> {\n  const { releaseName, filenameWithExt, checksums, githubOrgRepo = \"electron-userland/electron-builder-binaries\" } = options\n\n  const file = await _downloadArtifact(`https://github.com/${githubOrgRepo}/releases/download/`, releaseName, filenameWithExt, checksums)\n\n  return file\n}\n\n/**\n * Downloads, validates, and extracts a .tar.gz from a release URL\n */\nasync function _downloadArtifact(baseUrl: string, releaseName: string, filenameWithExt: string, checksums: Record<string, string>): Promise<string> {\n  const suffix = hashUrlSafe(`${baseUrl}-${releaseName}-${filenameWithExt}`, 5)\n  const folderName = `${filenameWithExt.replace(/\\.(tar\\.gz|tgz)$/, \"\")}-${suffix}`\n  const extractDir = path.join(getCacheDirectory(), releaseName, folderName)\n  const extractionCompleteMarker = `${extractDir}.complete`\n\n  // Ensure download directory exists before trying to lock\n  await fs.mkdir(extractDir, { recursive: true })\n\n  // Acquire the lock\n  let release: (() => Promise<void>) | undefined\n  try {\n    release = await lockfile.lock(extractDir, {\n      retries: {\n        retries: 5,\n        minTimeout: 1000,\n        maxTimeout: 5000,\n      },\n      stale: 60000,\n    })\n\n    const varName = \"ELECTRON_DOWNLOAD_CACHE_MODE\"\n    const cacheOverride = process.env[varName]?.trim()\n\n    let cacheMode: ElectronDownloadCacheMode = ElectronDownloadCacheMode.ReadWrite\n    if (cacheOverride && Number(cacheOverride) in ElectronDownloadCacheMode) {\n      cacheMode = Number(cacheOverride)\n      log.debug({ mode: cacheMode }, `cache mode overridden via env var ${varName}`)\n    }\n\n    if (await exists(extractionCompleteMarker)) {\n      log.debug({ file: filenameWithExt, path: extractDir }, \"using cached artifact - skipping download/extract\")\n      return extractDir\n    }\n\n    // These are just stubs. Actual url construction/file naming are in `mirrorOptions` below.\n    const details: ElectronDownloadRequest = {\n      // Needs to be higher than 1.3.2 to avoid @electron/get validation shortcut\n      // https://github.com/electron/get/blob/05c466d4fc60fa0c83064df28dce245eb83d63c9/src/index.ts#L60\n      version: \"9.9.9\",\n      artifactName: filenameWithExt, // also is the output filename\n    }\n\n    const progress = process.stdout.isTTY ? new MultiProgress() : null\n    const progressBar = progress?.createBar(`${\" \".repeat(PADDING + 2)}[:bar] :percent | ${filenameWithExt}`, { total: 100 })\n\n    const downloadOptions: GotDownloaderOptions = {\n      getProgressCallback: info => {\n        progressBar?.update(info.percent != null ? Math.floor(info.percent * 100) : 0)\n        return Promise.resolve()\n      },\n    }\n    const options: ElectronDownloadRequestOptions = {\n      cacheRoot: path.resolve(getCacheDirectory(), \"downloads\"),\n      cacheMode,\n      downloadOptions,\n      checksums,\n      mirrorOptions: {\n        // `${opts.mirror}${opts.customDir}/${opts.customFilename}`\n        mirror: baseUrl,\n        customDir: releaseName,\n        customFilename: filenameWithExt,\n      },\n    }\n\n    log.info({ release: releaseName, file: filenameWithExt }, \"downloading\")\n    progressBar?.render()\n    const downloadedFile = await get.downloadArtifact({\n      ...details,\n      ...options,\n      isGeneric: true,\n    })\n\n    await tar.extract({\n      file: downloadedFile,\n      cwd: extractDir,\n      strip: 1, // Strip the top-level directory from the archive\n    })\n\n    // Write the extraction complete marker file to indicate successful extraction and prevent future re-extraction\n    await fs.writeFile(extractionCompleteMarker, \"\")\n\n    log.debug({ file: filenameWithExt, path: extractDir }, \"downloaded\")\n    progressBar?.update(100)\n    progressBar?.terminate()\n\n    return extractDir\n  } finally {\n    // Release the lock\n    if (release) {\n      await release()\n    }\n  }\n}\n\nconst versionToPromise = new Map<string, Promise<string>>()\n\nexport function download(url: string, output: string, checksum?: string | null): Promise<void> {\n  const args = [\"download\", \"--url\", url, \"--output\", output]\n  if (checksum != null) {\n    args.push(\"--sha512\", checksum)\n  }\n  return executeAppBuilder(args) as Promise<any>\n}\n\nexport function getBinFromCustomLoc(name: string, version: string, binariesLocUrl: string, checksum: string): Promise<string> {\n  const dirName = `${name}-${version}`\n  return getBin(dirName, binariesLocUrl, checksum)\n}\n\nexport function getBinFromUrl(releaseName: string, filenameWithExt: string, checksum: string, githubOrgRepo = \"electron-userland/electron-builder-binaries\"): Promise<string> {\n  let url: string\n  if (process.env.ELECTRON_BUILDER_BINARIES_DOWNLOAD_OVERRIDE_URL) {\n    url = process.env.ELECTRON_BUILDER_BINARIES_DOWNLOAD_OVERRIDE_URL + \"/\" + filenameWithExt\n  } else {\n    const baseUrl =\n      process.env.NPM_CONFIG_ELECTRON_BUILDER_BINARIES_MIRROR ||\n      process.env.npm_config_electron_builder_binaries_mirror ||\n      process.env.npm_package_config_electron_builder_binaries_mirror ||\n      process.env.ELECTRON_BUILDER_BINARIES_MIRROR ||\n      `https://github.com/${githubOrgRepo}/releases/download/`\n    const middleUrl =\n      process.env.NPM_CONFIG_ELECTRON_BUILDER_BINARIES_CUSTOM_DIR ||\n      process.env.npm_config_electron_builder_binaries_custom_dir ||\n      process.env.npm_package_config_electron_builder_binaries_custom_dir ||\n      process.env.ELECTRON_BUILDER_BINARIES_CUSTOM_DIR ||\n      releaseName\n    url = `${baseUrl}${middleUrl}/${filenameWithExt}`\n  }\n\n  const cacheKey = `${releaseName}-${path.basename(filenameWithExt, path.extname(filenameWithExt))}`\n  return getBin(cacheKey, url, checksum)\n}\n\nexport function getBin(cacheKey: string, url?: string | null, checksum?: string | null): Promise<string> {\n  // Old cache is ignored if cache environment variable changes\n  const cacheName = sanitizeFileName(`${process.env.ELECTRON_BUILDER_CACHE ?? \"\"}${cacheKey}`)\n  let promise = versionToPromise.get(cacheName) // if rejected, we will try to download again\n\n  if (promise != null) {\n    return promise\n  }\n\n  promise = doGetBin(cacheKey, url, checksum)\n  versionToPromise.set(cacheName, promise)\n  return promise\n}\n\nfunction doGetBin(name: string, url: string | Nullish, checksum: string | Nullish): Promise<string> {\n  const args = [\"download-artifact\", \"--name\", name]\n  if (url != null) {\n    args.push(\"--url\", url)\n  }\n  if (checksum != null) {\n    args.push(\"--sha512\", checksum)\n  }\n  return executeAppBuilder(args)\n}\n"]}