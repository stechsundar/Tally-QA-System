{"version":3,"file":"AppxCapabilities.js","sourceRoot":"","sources":["../../src/targets/AppxCapabilities.ts"],"names":[],"mappings":"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","sourcesContent":["export interface Capability {\n  readonly nsAlias: string | null\n  readonly nsURI: string | null\n  readonly name: string\n\n  toXMLString(): string\n}\n\ntype CapabilityConfig = {\n  nsAlias: string | null\n  nsURI: string | null\n  declareNS: boolean\n  elementName: string\n}\n\nclass AppxCapability implements Capability {\n  constructor(\n    public readonly nsAlias: string | null,\n    public readonly nsURI: string | null,\n    private readonly declareNS: boolean,\n    private readonly elementName: string,\n    public readonly name: string\n  ) {\n    if (!this.nsAlias && this.declareNS) {\n      throw new Error(\"local declaration of namespace without prefix is not supported\")\n    }\n  }\n\n  toXMLString(): string {\n    const tagName = this.nsAlias ? `${this.nsAlias}:${this.elementName}` : this.elementName\n    if (this.declareNS) {\n      return `<${tagName} xmlns:${this.nsAlias}=\"${this.nsURI}\" Name=\"${this.name}\"/>`\n    }\n    return `<${tagName} Name=\"${this.name}\"/>`\n  }\n}\n\n// Capability type configurations\nconst CAPABILITY_TYPES: Record<string, CapabilityConfig> = {\n  common: {\n    nsAlias: null,\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/foundation/windows10\",\n    declareNS: false,\n    elementName: \"Capability\",\n  },\n  uap: {\n    nsAlias: \"uap\",\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/uap/windows10\",\n    declareNS: false, // ns already declared in template\n    elementName: \"Capability\",\n  },\n  device: {\n    nsAlias: null,\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/foundation/windows10\",\n    declareNS: false,\n    elementName: \"DeviceCapability\",\n  },\n  uap6: {\n    nsAlias: \"uap6\",\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/uap/windows10/6\",\n    declareNS: true,\n    elementName: \"Capability\",\n  },\n  uap7: {\n    nsAlias: \"uap7\",\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/uap/windows10/7\",\n    declareNS: true,\n    elementName: \"Capability\",\n  },\n  mobile: {\n    nsAlias: \"mobile\",\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/mobile/windows10\",\n    declareNS: true,\n    elementName: \"Capability\",\n  },\n  rescap: {\n    nsAlias: \"rescap\",\n    nsURI: \"http://schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities\",\n    declareNS: false, // ns already declared in template\n    elementName: \"Capability\",\n  },\n} as const\n\ntype CapabilityType = keyof typeof CAPABILITY_TYPES\n\n// Map of capability types to their capability names (grouped by type)\nconst CAPABILITY_MAP = new Map<CapabilityType, string[]>([\n  // Common capabilities\n  [\n    \"common\",\n    [\n      \"internetClient\",\n      \"internetClientServer\",\n      \"privateNetworkClientServer\",\n      \"codeGeneration\",\n      \"allJoyn\",\n      \"backgroundMediaPlayback\",\n      \"remoteSystem\",\n      \"spatialPerception\",\n      \"userDataTasks\",\n      \"userNotificationListener\",\n    ],\n  ],\n\n  // UAP capabilities\n  [\n    \"uap\",\n    [\n      \"musicLibrary\",\n      \"picturesLibrary\",\n      \"videosLibrary\",\n      \"removableStorage\",\n      \"appointments\",\n      \"contacts\",\n      \"phoneCall\",\n      \"phoneCallHistoryPublic\",\n      \"userAccountInformation\",\n      \"voipCall\",\n      \"objects3D\",\n      \"chat\",\n      \"blockedChatMessages\",\n      \"enterpriseAuthentication\",\n      \"sharedUserCertificates\",\n      \"documentsLibrary\",\n    ],\n  ],\n\n  // Mobile capabilities\n  [\"mobile\", [\"recordedCallsFolder\"]],\n\n  // Restricted capabilities\n  [\n    \"rescap\",\n    [\n      \"enterpriseDataPolicy\",\n      \"appCaptureSettings\",\n      \"cellularDeviceControl\",\n      \"cellularDeviceIdentity\",\n      \"cellularMessaging\",\n      \"deviceUnlock\",\n      \"dualSimTiles\",\n      \"enterpriseDeviceLockdown\",\n      \"inputInjectionBrokered\",\n      \"inputObservation\",\n      \"inputSuppression\",\n      \"networkingVpnProvider\",\n      \"packageManagement\",\n      \"screenDuplication\",\n      \"userPrincipalName\",\n      \"walletSystem\",\n      \"locationHistory\",\n      \"confirmAppClose\",\n      \"phoneCallHistory\",\n      \"appointmentsSystem\",\n      \"chatSystem\",\n      \"contactsSystem\",\n      \"email\",\n      \"emailSystem\",\n      \"phoneCallHistorySystem\",\n      \"smsSend\",\n      \"userDataSystem\",\n      \"previewStore\",\n      \"firstSignInSettings\",\n      \"teamEditionExperience\",\n      \"remotePassportAuthentication\",\n      \"previewUiComposition\",\n      \"secureAssessment\",\n      \"networkConnectionManagerProvisioning\",\n      \"networkDataPlanProvisioning\",\n      \"slapiQueryLicenseValue\",\n      \"extendedBackgroundTaskTime\",\n      \"extendedExecutionBackgroundAudio\",\n      \"extendedExecutionCritical\",\n      \"extendedExecutionUnconstrained\",\n      \"deviceManagementDmAccount\",\n      \"deviceManagementFoundation\",\n      \"deviceManagementWapSecurityPolicies\",\n      \"deviceManagementEmailAccount\",\n      \"packagePolicySystem\",\n      \"gameList\",\n      \"xboxAccessoryManagement\",\n      \"cortanaSpeechAccessory\",\n      \"accessoryManager\",\n      \"interopServices\",\n      \"inputForegroundObservation\",\n      \"oemDeployment\",\n      \"oemPublicDirectory\",\n      \"appLicensing\",\n      \"locationSystem\",\n      \"userDataAccountsProvider\",\n      \"previewPenWorkspace\",\n      \"secondaryAuthenticationFactor\",\n      \"storeLicenseManagement\",\n      \"userSystemId\",\n      \"targetedContent\",\n      \"uiAutomation\",\n      \"gameBarServices\",\n      \"appCaptureServices\",\n      \"appBroadcastServices\",\n      \"audioDeviceConfiguration\",\n      \"backgroundMediaRecording\",\n      \"previewInkWorkspace\",\n      \"startScreenManagement\",\n      \"cortanaPermissions\",\n      \"allAppMods\",\n      \"expandedResources\",\n      \"protectedApp\",\n      \"gameMonitor\",\n      \"appDiagnostics\",\n      \"devicePortalProvider\",\n      \"enterpriseCloudSSO\",\n      \"backgroundVoIP\",\n      \"oneProcessVoIP\",\n      \"developmentModeNetwork\",\n      \"broadFileSystemAccess\",\n      \"smbios\",\n      \"runFullTrust\",\n      \"allowElevation\",\n      \"teamEditionDeviceCredential\",\n      \"teamEditionView\",\n      \"cameraProcessingExtension\",\n      \"networkDataUsageManagement\",\n      \"phoneLineTransportManagement\",\n      \"unvirtualizedResources\",\n      \"modifiableApp\",\n      \"packageWriteRedirectionCompatibilityShim\",\n      \"customInstallActions\",\n      \"packagedServices\",\n      \"localSystemServices\",\n      \"backgroundSpatialPerception\",\n      \"uiAccess\",\n    ],\n  ],\n\n  // UAP6 capabilities\n  [\"uap6\", [\"graphicsCapture\"]],\n\n  // UAP7 capabilities\n  [\"uap7\", [\"globalMediaControl\"]],\n\n  // Device capabilities\n  [\n    \"device\",\n    [\n      \"location\",\n      \"microphone\",\n      \"webcam\",\n      \"proximity\",\n      \"pointOfService\",\n      \"wiFiControl\",\n      \"radios\",\n      \"optical\",\n      \"activity\",\n      \"humanPresence\",\n      \"serialcommunication\",\n      \"gazeInput\",\n      \"lowLevel\",\n      \"packageQuery\",\n    ],\n  ],\n])\n\n// Factory function to create capabilities\nfunction createCapability(type: CapabilityType, name: string): Capability {\n  const config = CAPABILITY_TYPES[type]\n  if (!config) {\n    throw new Error(`unknown capability type '${type}'`)\n  }\n  return new AppxCapability(config.nsAlias, config.nsURI, config.declareNS, config.elementName, name)\n}\n\n// Export ordered list of all capabilities (order matters per Microsoft docs)\n// Schema: https://learn.microsoft.com/en-us/uwp/schemas/appxpackage/uapmanifestschema/schema-root\n// Packaging: https://learn.microsoft.com/en-us/windows/uwp/packaging/app-capability-declarations\n// !! the docs are not clear in which order is correct. the schema doc specifies an order that differs from the order described in packaging doc !!\n// https://learn.microsoft.com/en-us/answers/questions/92754/why-does-the-order-of-items-in-(capabilities)-of-p\n// as stated in the above post the packaging docs is the one to follow as MakeAppx.exe is following this specification when it checks the manifests validity\nexport const CAPABILITIES: Capability[] = Array.from(CAPABILITY_MAP.entries()).flatMap(([type, names]) => names.map(name => createCapability(type, name)))\n\nconst CAPABILITY_NAMES: Set<string> = new Set<string>(Array.from(CAPABILITY_MAP.values()).flat())\n\nexport function isValidCapabilityName(name: string | null | undefined): boolean {\n  return !!name && CAPABILITY_NAMES.has(name)\n}\n"]}